<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ ÙˆÙ…ÙˆØ³ÙˆØ¹Ø© Ø§Ù„Ø­Ø¶Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙŠØ©</title>
  <style>
    /* GENERAL STYLES */
    body {
      margin: 0;
      padding: 0;
      font-family: "Cairo", Arial, sans-serif;
      direction: rtl;
      background-color: #f5f5f5;
    }
    /* FIXED TOP NAVIGATION BAR */
    .top-bar {
      display: flex;
      justify-content: space-around;
      align-items: center;
      background-color: #2a4d69;
      color: white;
      padding: 15px 0;
      border-bottom: 4px solid #007acc;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1000;
    }
    .top-bar button {
      background-color: #007acc;
      border: none;
      padding: 12px 25px;
      color: white;
      font-size: 1.2em;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }
    .top-bar button:hover {
      background-color: #005f99;
      transform: scale(1.05);
    }
    /* SECTION STYLING */
    .section {
      display: none;
      padding: 20px;
      margin-top: 80px; /* to avoid overlapping with fixed top bar */
    }
    .section.active {
      display: block;
    }
    /* APP SECTION STYLING */
    #app {
      background-color: #f9f9f9;
      color: #333;
      text-align: center;
      padding: 20px;
    }
    #app header {
      padding: 20px;
      background-color: #2a4d69;
      color: white;
    }
    #app header h1 {
      font-size: 2.5em;
      margin: 0;
    }
    #app header p {
      font-size: 1.2em;
      margin-top: 10px;
      color: #d1ecf1;
    }
    .flag-icons {
      margin-top: 10px;
    }
    .flag-icons img {
      width: 30px;
      vertical-align: middle;
      margin: 0 5px;
    }
    .language-selector {
      margin-top: 10px;
    }
    .language-selector label {
      font-size: 1em;
      color: #f9f9f9;
    }
    .language-selector select {
      font-size: 1em;
      padding: 5px;
      border-radius: 5px;
      border: 1px solid #2a4d69;
      color: #2a4d69;
      background-color: #fff;
    }
    .search-container {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #search-bar {
      width: 90%;
      max-width: 400px;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #007acc;
      font-size: 1em;
      text-align: right;
      box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
    }
    #search-bar:focus {
      border-color: #005f99;
      outline: none;
    }
    #content-section {
      margin-top: 20px;
      background-color: #f1f1f1;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      margin: 20px auto;
      box-shadow: 0px 4px 8px rgba(0, 0, 51, 0.3);
    }
    #content-section h2 {
      color: #2a4d69;
    }
    #content-section img {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 10px;
    }
    .full-content {
      text-align: left;
      padding: 10px;
      margin-top: 10px;
      max-width: 100%;
      overflow-x: auto;
      word-wrap: break-word;
    }
    .full-content img,
    .full-content audio,
    .full-content video {
      max-width: 100%;
      height: auto;
      margin-top: 10px;
    }
    /* RETRO STYLE BUTTONS */
    .old-style-button {
      background-color: #e0e0e0;
      border: 2px outset #999;
      color: #000;
      font-family: "Courier New", monospace;
      padding: 8px 16px;
      border-radius: 0;
      box-shadow: 2px 2px 0px #ccc;
      margin: 5px;
      cursor: pointer;
    }
    .old-style-button:active {
      border-style: inset;
      box-shadow: none;
    }
    /* CUSTOM GAME CONTROLLER STYLE */
    .custom-controller {
      background-color: #fff;
      border: 2px solid #007acc;
      color: #007acc;
      font-family: "Courier New", monospace;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      box-shadow: 3px 3px 0px #999;
      cursor: pointer;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s, transform 0.2s;
    }
    .custom-controller:active {
      transform: scale(0.95);
    }
    /* AUTHENTICATION STYLES */
    .auth-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f4f4f4;
    }
    .auth-box {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 350px;
      padding: 20px;
      border-radius: 20px;
      background-color: #ffffff;
      color: #000080;
      border: 1px solid #0000ff;
    }
    .title {
      font-size: 28px;
      font-weight: 600;
      letter-spacing: -1px;
      padding-left: 30px;
      color: #0000ff;
      position: relative;
    }
    .title::before,
    .title::after {
      content: "";
      position: absolute;
      height: 16px;
      width: 16px;
      border-radius: 50%;
      left: 0;
      background-color: #0000ff;
    }
    .title::after {
      animation: pulse 1s linear infinite;
    }
    .message, .signin {
      font-size: 14.5px;
      color: #000080;
    }
    .signin {
      text-align: center;
    }
    .signin a {
      color: #0000ff;
    }
    .signin a:hover {
      text-decoration: underline;
    }
    .flex {
      display: flex;
      gap: 6px;
      width: 100%;
    }
    .form label {
      position: relative;
    }
    .form label .input {
      background-color: #e6f0ff;
      color: #000080;
      width: 100%;
      padding: 20px 5px 5px 10px;
      border: 1px solid #0000ff;
      border-radius: 10px;
      outline: none;
    }
    .form label .input + span {
      color: #000080;
      position: absolute;
      left: 10px;
      top: 0;
      font-size: 0.9em;
      cursor: text;
      transition: 0.3s ease;
    }
    .form label .input:placeholder-shown + span {
      top: 12.5px;
      font-size: 0.9em;
    }
    .form label .input:focus + span,
    .form label .input:valid + span {
      color: #0000ff;
      top: 0;
      font-size: 0.7em;
      font-weight: 600;
    }
    .input {
      font-size: medium;
    }
    .submit {
      border: none;
      padding: 10px;
      border-radius: 10px;
      color: #fff;
      font-size: 16px;
      background-color: #0000ff;
      transition: background-color 0.3s ease;
    }
    .submit:hover {
      background-color: #0000e6;
    }
    @keyframes pulse {
      from { transform: scale(0.9); opacity: 1; }
      to { transform: scale(1.8); opacity: 0; }
    }
    /* GAME SECTION STYLING */
    #game {
      background-color: #1a1a2e;
      color: white;
      height: 100vh;
      padding-top: 70px;
      position: relative;
    }
    #gameCanvas {
      display: block;
      width: 100%;
      height: 70%;
      background: url('https://cdn.leonardo.ai/users/219c0453-d09b-4398-b975-2495e47ecf5e/generations/ee33a647-aeba-40c5-9de5-5e8691a9b400/Default_A_vibrant_ancient_Egyptianinspired_platformer_game_bac_0.jpg') no-repeat center center;
      background-size: cover;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 10px;
    }
    #restartButton {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 15px 30px;
      background-color: red;
      font-size: 1.5rem;
      border-radius: 10px;
      display: none;
      z-index: 2000;
    }
    .info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background-color: #222;
      font-size: 1.2rem;
    }
    .life-bar-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    #lifeBar {
      width: 100px;
      height: 10px;
      background-color: red;
      border: 1px solid white;
    }
    .score-info {
      display: flex;
      gap: 20px;
      font-size: 1rem;
    }
    /* RESPONSIVE ADJUSTMENTS FOR MOBILE */
    @media (max-width: 600px) {
      #app header h1 { font-size: 1.8em; }
      #app header p { font-size: 1em; }
      #search-bar { width: 80%; padding: 12px; }
      #content-section { padding: 15px; }
      .controls button { width: 50px; height: 50px; font-size: 1.2rem; }
      .custom-controller { width: 50px; height: 50px; font-size: 1.2rem; }
    }
  </style>
</head>
<body>
  <!-- TOP NAVIGATION BAR -->
  <div class="top-bar">
    <button class="section-button" onclick="showSection('app')">Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
    <button class="section-button" onclick="showSection('game')">Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
    <button class="section-button" onclick="showSection('auth')">ØªØ³Ø¬ÙŠÙ„</button>
  </div>
  <!-- AUTH SECTION -->
  <div id="auth" class="section">
    <div class="auth-container">
      <div class="auth-box">
        <div id="authSection">
          <!-- SIGNUP FORM -->
          <form class="form" id="signupForm">
            <p class="title">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</p>
            <p class="message">Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ùƒ ÙˆØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</p>
            <div class="flex">
              <label>
                <input class="input" type="text" id="firstname" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„" required>
                <span></span>
              </label>
              <label>
                <input class="input" type="text" id="lastname" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ" required>
                <span></span>
              </label>
            </div>
            <label>
              <input class="input" type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
              <span></span>
            </label>
            <label>
              <input class="input" type="password" id="password" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø±ÙˆØ±" required>
              <span></span>
            </label>
            <label>
              <input class="input" type="password" id="confirmPassword" placeholder="ØªØ£ÙƒÙŠØ¯ Ø±Ù‚Ù… Ø§Ù„Ù…Ø±ÙˆØ±" required>
              <span></span>
            </label>
            <button type="button" class="submit" onclick="signup()">Ø¥Ù†Ø´Ø§Ø¡</button>
            <p class="signin">Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ 
              <a href="#" onclick="showSignin()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
            </p>
          </form>
          <!-- SIGNIN FORM -->
          <form class="form" id="signinForm" style="display: none;">
            <p class="title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>
            <p class="message">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ù…Ù† Ø¬Ø¯ÙŠØ¯! ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</p>
            <label>
              <input class="input" type="email" id="signinEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
              <span></span>
            </label>
            <label>
              <input class="input" type="password" id="signinPassword" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø±ÙˆØ±" required>
              <span></span>
            </label>
            <button type="button" class="submit" onclick="signin()">Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <p class="signin">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ  
              <a href="#" onclick="showSignup()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
            </p>
          </form>
          <!-- LOGOUT OPTION -->
          <div id="logoutOption" style="display: none;">
            <p>Ø£Ù†Øª ÙÙŠ Ù‚ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>
            <button class="submit" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- GAME SECTION -->
  <div id="game" class="section">
    <div class="game-container">
      <canvas id="gameCanvas"></canvas>
      <div class="controls">
        <button id="upButton" class="custom-controller">â¬†</button>
        <button id="leftButton" class="custom-controller">â¬…</button>
        <button id="shootButton" class="custom-controller">ğŸ”«</button>
        <button id="rightButton" class="custom-controller">â¡</button>
        <button id="downButton" class="custom-controller">â¬‡</button>
      </div>
      <div class="info">
        <div class="life-bar-container">
          <span>Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„ØµØ­ÙŠ:</span>
          <div id="lifeBar"></div>
        </div>
        <div class="score-info">
          <span id="scoreDisplay">Ø§Ù„Ù†ØªÙŠØ¬Ø©: 0</span>
          <span id="requiredScore">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: 5</span>
        </div>
      </div>
      <button id="restartButton" onclick="resetGame()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„</button>
    </div>
  </div>
  <!-- APP SECTION -->
  <div id="app" class="section">
    <header>
      <div id="top-message">
        <span>Free Palestine ÙÙ„Ø³Ø·ÙŠÙ† ÙÙŠ Ø§Ù„Ù‚Ù„Ø¨</span>
        <div class="flag-icons">
          <img src="https://upload.wikimedia.org/wikipedia/commons/0/00/Flag_of_Palestine.svg" alt="Palestine Flag">
          <img src="https://upload.wikimedia.org/wikipedia/commons/f/fe/Flag_of_Egypt.svg" alt="Egypt Flag">
        </div>
      </div>
      <h1 id="main-title">Ù…ÙˆØ³ÙˆØ¹Ø© Ø§Ù„Ø­Ø¶Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙŠØ©</h1>
      <p id="main-subtitle">ğŸ‡ªğŸ‡¬ Ù…ØµØ± - ØªØ§Ø±ÙŠØ®ØŒ Ø­Ø¶Ø§Ø±Ø©ØŒ ÙˆØ«Ù‚Ø§ÙØ©</p>
      <div class="language-selector">
        <label for="language" id="language-label">Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©:</label>
        <select id="language" onchange="changeLanguage()">
          <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
          <option value="en">English</option>
        </select>
      </div>
    </header>
    <main>
      <section class="introduction">
        <h2 id="introduction-title">Ù„Ù…Ø­Ø© Ø¹Ù† Ø§Ù„Ø­Ø¶Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙŠØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</h2>
        <div class="search-container">
          <input type="text" id="search-bar" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ØµØ±ÙŠ...">
          <button id="search-button" class="old-style-button" onclick="fetchContent()">Ø§Ø¨Ø­Ø«</button>
        </div>
      </section>
      <section id="content-section">
        <!-- Wikipedia content will load here -->
      </section>
    </main>
    <footer>
      <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; 2024 - Ù…ÙˆØ³ÙˆØ¹Ø© Ø§Ù„Ø­Ø¶Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙŠØ©</p>
    </footer>
  </div>
  <script>
    // -------------------- Global Variables and Translations --------------------
    let fullArticleDisplayed = false;
    let currentLanguage = 'ar';
    let searchResults = [];
    let speechSynthesisInstance = null;
    let currentArticleTitle = "";
    let currentArticleExtract = "";
    const YOUTUBE_API_KEY = "AIzaSyCe3BZbOsFYE4HtHU2n1AgGqFCNORciGks";
    const translations = {
      ar: {
        mainTitle: "Ù…ÙˆØ³ÙˆØ¹Ø© Ø§Ù„Ø­Ø¶Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙŠØ©",
        searchPlaceholder: "Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ØµØ±ÙŠ...",
        searchButton: "Ø§Ø¨Ø­Ø«",
        readMore: "Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯",
        readLess: "Ø¹Ø±Ø¶ Ø£Ù‚Ù„",
        listenArticle: "Ø§Ø³ØªÙ…Ø¹ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù‚Ø§Ù„",
        stopListening: "Ø£ÙˆÙ‚Ù Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©",
        noResults: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬"
      },
      en: {
        mainTitle: "Egyptian Civilization Encyclopedia",
        searchPlaceholder: "Search for Egyptian history...",
        searchButton: "Search",
        readMore: "Show more",
        readLess: "Show less",
        listenArticle: "Listen to the article",
        stopListening: "Stop Listening",
        noResults: "No results found"
      }
    };

    // -------------------- Game Control Variables --------------------
    let gameActive = false;
    let gameAnimationFrameId = null;
    let enemyInterval = null; // to control enemy generation

    // For toggling game pause/resume with Shift+P
    function toggleGamePause() {
      if (gameActive) {
        pauseGame();
      } else {
        startGame();
      }
    }

    function startGame() {
      if (!gameActive) {
        gameActive = true;
        // Restart enemy generation
        enemyInterval = setInterval(createEnemy, 2000);
        gameLoop();
      }
    }
    function pauseGame() {
      if (gameActive) {
        cancelAnimationFrame(gameAnimationFrameId);
        clearInterval(enemyInterval);
        gameActive = false;
      }
    }

    // -------------------- Language Change and UI Update --------------------
    function changeLanguage() {
      const languageSelect = document.getElementById("language");
      currentLanguage = languageSelect.value;
      const translation = translations[currentLanguage];
      document.getElementById("main-title").textContent = translation.mainTitle;
      document.getElementById("search-bar").placeholder = translation.searchPlaceholder;
      document.getElementById("search-button").textContent = translation.searchButton;
      fetchContent("Ø§Ù„Ø­Ø¶Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙŠØ©");
    }

    // -------------------- Section Navigation with Game Pause/Resume --------------------
    function showSection(sectionId) {
      const currentActive = document.querySelector('.section.active');
      if (currentActive && currentActive.id === 'game' && sectionId !== 'game') {
        pauseGame();
      }
      document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
      document.getElementById(sectionId).classList.add('active');
      if (sectionId === 'game' && !gameActive) {
        startGame();
      }
    }

    // -------------------- Auth Functions --------------------
    function showSignup() {
      document.getElementById('signupForm').style.display = 'block';
      document.getElementById('signinForm').style.display = 'none';
      document.getElementById('logoutOption').style.display = 'none';
    }
    function showSignin() {
      document.getElementById('signupForm').style.display = 'none';
      document.getElementById('signinForm').style.display = 'block';
      document.getElementById('logoutOption').style.display = 'none';
    }
    function signup() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      if (password !== confirmPassword) {
        alert('ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©!');
        return;
      }
      alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
      document.getElementById('signupForm').style.display = 'none';
      document.getElementById('logoutOption').style.display = 'block';
    }
    function signin() {
      const email = document.getElementById('signinEmail').value;
      const password = document.getElementById('signinPassword').value;
      if (password.trim() === '') {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±!');
        return;
      }
      alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
      document.getElementById('signinForm').style.display = 'none';
      document.getElementById('logoutOption').style.display = 'block';
    }
    function logout() {
      alert('Ù„Ù‚Ø¯ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬!');
      document.getElementById('logoutOption').style.display = 'none';
      showSignin();
    }

    // -------------------- Game Setup --------------------
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight * 0.7;
    const playerImg = new Image();
    playerImg.src = "https://i.postimg.cc/nXXZTdhT/player.png";
    const enemyImg = new Image();
    enemyImg.src = "https://i.postimg.cc/9Rnrg4jq/enemy.png";
    let player = {
      x: 50,
      y: canvas.height / 2 - 50,
      width: 70,
      height: 90,
      speed: 10,
      health: 100,
      label: "Ù…ØµØ±",
      bullets: []
    };
    let enemies = [];
    let score = 0;
    let requiredScore = 5;
    let enemySpeedMultiplier = 1;
    const lifeBar = document.getElementById("lifeBar");
    const scoreDisplay = document.getElementById("scoreDisplay");
    const requiredScoreDisplay = document.getElementById("requiredScore");

    // Controller events using custom (retro circular) style
    document.getElementById("leftButton").addEventListener("click", () => {
      player.x = Math.max(0, player.x - player.speed);
    });
    document.getElementById("rightButton").addEventListener("click", () => {
      player.x = Math.min(canvas.width - player.width, player.x + player.speed);
    });
    document.getElementById("upButton").addEventListener("click", () => {
      player.y = Math.max(0, player.y - player.speed);
    });
    document.getElementById("downButton").addEventListener("click", () => {
      player.y = Math.min(canvas.height - player.height, player.y + player.speed);
    });
    document.getElementById("shootButton").addEventListener("click", () => {
      player.bullets.push({ x: player.x + player.width, y: player.y + player.height / 2, radius: 5 });
    });
    // Key listeners: "s" for shoot, arrow keys for movement, Shift+M for toggle full article, Shift+L for TTS, Shift+P for game pause/resume.
    document.addEventListener("keydown", (e) => {
      if (e.key.toLowerCase() === "s") {
        player.bullets.push({ x: player.x + player.width, y: player.y + player.height / 2, radius: 5 });
      }
      switch(e.key) {
        case "ArrowLeft":
          player.x = Math.max(0, player.x - player.speed);
          break;
        case "ArrowRight":
          player.x = Math.min(canvas.width - player.width, player.x + player.speed);
          break;
        case "ArrowUp":
          player.y = Math.max(0, player.y - player.speed);
          break;
        case "ArrowDown":
          player.y = Math.min(canvas.height - player.height, player.y + player.speed);
          break;
      }
      // Shift+M toggles the full article view
      if(e.shiftKey && e.key === "M") {
        e.preventDefault();
        if(currentArticleTitle) toggleFullArticle(currentArticleTitle);
      }
      // Shift+L toggles reading the article (start/stop TTS)
      if(e.shiftKey && e.key === "L") {
        e.preventDefault();
        if(currentArticleExtract) toggleSpeech(currentArticleExtract);
      }
      // Shift+P toggles game pause/resume
      if(e.shiftKey && e.key === "P") {
        e.preventDefault();
        toggleGamePause();
      }
    });

    function isColliding(a, b) {
      return a.x < b.x + b.width &&
             a.x + a.width > b.x &&
             a.y < b.y + b.height &&
             a.y + a.height > b.y;
    }

    function createEnemy() {
      const enemySize = 70;
      const enemyY = Math.random() * (canvas.height - enemySize);
      enemies.push({
        x: canvas.width,
        y: enemyY,
        width: enemySize,
        height: 90,
        speed: (3 + Math.random() * 2) * enemySpeedMultiplier,
        label: "Ø¹Ø¯Ùˆ"
      });
    }

    function drawPlayer() {
      ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
      ctx.fillStyle = "white";
      ctx.font = "20px Arial";
      ctx.fillText(player.label, player.x + player.width / 4, player.y - 15);
      player.bullets.forEach((bullet, index) => {
        bullet.x += 10;
        ctx.beginPath();
        ctx.arc(bullet.x, bullet.y, bullet.radius, 0, Math.PI * 2);
        ctx.fillStyle = "yellow";
        ctx.fill();
        if (bullet.x > canvas.width) {
          player.bullets.splice(index, 1);
        }
      });
    }
    function drawEnemies() {
      enemies.forEach((enemy, index) => {
        enemy.x -= enemy.speed;
        if (enemy.x + enemy.width < 0) {
          enemies.splice(index, 1);
        }
        if (isColliding(enemy, player)) {
          player.health -= 10;
          if (player.health < 0) player.health = 0;
          enemies.splice(index, 1);
        }
        player.bullets.forEach((bullet, bulletIndex) => {
          if (
            bullet.x > enemy.x &&
            bullet.x < enemy.x + enemy.width &&
            bullet.y > enemy.y &&
            bullet.y < enemy.y + enemy.height
          ) {
            enemies.splice(index, 1);
            player.bullets.splice(bulletIndex, 1);
            score++;
          }
        });
        ctx.drawImage(enemyImg, enemy.x, enemy.y, enemy.width, enemy.height);
        ctx.fillStyle = "white";
        ctx.font = "20px Arial";
        ctx.fillText(enemy.label, enemy.x + enemy.width / 4, enemy.y - 15);
      });
    }
    function updateLifeBar() {
      lifeBar.style.width = `${player.health}%`;
      if (player.health <= 0) {
        endGame();
      }
    }
    // Increase required score, reset score, and increase enemy speed when threshold is met.
    function checkScore() {
      if (score >= requiredScore) {
        requiredScore += 5;
        enemySpeedMultiplier += 0.2;
        score = 0;
      }
    }
    function endGame() {
      cancelAnimationFrame(gameAnimationFrameId);
      clearInterval(enemyInterval);
      gameActive = false;
      document.getElementById("restartButton").style.display = "block";
    }
    function resetGame() {
      player.health = 100;
      score = 0;
      requiredScore = 5;
      enemySpeedMultiplier = 1;
      enemies = [];
      document.getElementById("restartButton").style.display = "none";
      if (!gameActive) {
        startGame();
      }
    }
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPlayer();
      drawEnemies();
      updateLifeBar();
      scoreDisplay.textContent = `Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${score}`;
      requiredScoreDisplay.textContent = `Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: ${requiredScore}`;
      checkScore();
      gameAnimationFrameId = requestAnimationFrame(gameLoop);
    }

    // -------------------- Wikipedia & YouTube Integration --------------------
    function fetchContent(query = null) {
      const searchQuery = query || document.getElementById("search-bar").value.trim() || "Ø§Ù„Ø­Ø¶Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙŠØ©";
      const wikiApiUrl = `https://${currentLanguage}.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(searchQuery)}&format=json&origin=*`;
      fetch(wikiApiUrl)
        .then(response => response.json())
        .then(data => {
          searchResults = data.query.search;
          displayContent();
          fetchYouTubeVideo(searchQuery);
        })
        .catch(error => {
          console.error("Error fetching data:", error);
        });
    }
    function displayContent() {
      if (searchResults.length === 0) {
        document.getElementById("content-section").innerHTML = `<p>${translations[currentLanguage].noResults}</p>`;
        return;
      }
      const result = searchResults[0];
      fetchPageContent(result.title);
    }
    function fetchPageContent(title) {
      currentArticleTitle = title;
      const wikiApiUrl = `https://${currentLanguage}.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
      fetch(wikiApiUrl)
        .then(response => response.json())
        .then(data => {
          currentArticleExtract = data.extract;
          document.getElementById("content-section").innerHTML = `
            <h2>${data.title}</h2>
            <p>${data.extract}</p>
            ${data.thumbnail ? `<img src="${data.thumbnail.source}" alt="${data.title}">` : ''}
            <div id="fullArticleContainer"></div>
            <button id="readMoreBtn" class="old-style-button" onclick="toggleFullArticle('${data.title}')">${translations[currentLanguage].readMore}</button>
            <button id="speechBtn" class="old-style-button" onclick="toggleSpeech('${data.extract.replace(/'/g, "\\'")}')">${translations[currentLanguage].listenArticle}</button>
            <div id="youtube-video"></div>
          `;
          fullArticleDisplayed = false;
          interceptArticleLinks();
        })
        .catch(error => {
          console.error("Error fetching page content:", error);
        });
    }
    async function toggleFullArticle(title) {
      const container = document.getElementById("fullArticleContainer");
      const btn = document.getElementById("readMoreBtn");
      if (fullArticleDisplayed) {
        container.innerHTML = "";
        btn.textContent = translations[currentLanguage].readMore;
        fullArticleDisplayed = false;
      } else {
        const wikiApiUrl = `https://${currentLanguage}.wikipedia.org/w/api.php?action=parse&page=${encodeURIComponent(title)}&format=json&origin=*`;
        try {
          const response = await fetch(wikiApiUrl);
          const data = await response.json();
          let fullContentHtml = data.parse.text['*'];
          // Replace protocol-relative URLs with https:
          fullContentHtml = fullContentHtml.replace(/src="\/\/(.*?)"/g, 'src="https://$1"');
          container.innerHTML = `<div class="full-content">${fullContentHtml}</div>`;
          // Ensure audio and video elements have controls
          const audioTags = container.querySelectorAll('audio');
          audioTags.forEach(audio => audio.setAttribute('controls', true));
          const videoTags = container.querySelectorAll('video');
          videoTags.forEach(video => video.setAttribute('controls', true));
          btn.textContent = translations[currentLanguage].readLess;
          fullArticleDisplayed = true;
          interceptArticleLinks();
        } catch (error) {
          console.error("Error fetching full page content:", error);
        }
      }
    }
    // Intercepts clicks on links in the full article to load new topics.
    function interceptArticleLinks() {
      const container = document.getElementById("fullArticleContainer");
      if (!container) return;
      container.querySelectorAll("a").forEach(link => {
        link.style.color = "#007acc";
        link.addEventListener("click", function(e) {
          e.preventDefault();
          const href = this.getAttribute("href");
          const newTopic = href && href.startsWith("/wiki/") ? href.replace(/^\/wiki\//, "") : this.textContent;
          if(newTopic) {
            document.getElementById("search-bar").value = newTopic;
            fetchContent(newTopic);
            window.scrollTo(0, 0);
          }
        });
      });
    }
    // -------------------- TTS: Listen to Article using SpeechSynthesis --------------------
    function toggleSpeech(text) {
      const speechBtn = document.getElementById("speechBtn");
      if (speechSynthesisInstance && speechSynthesis.speaking) {
        window.speechSynthesis.cancel();
        speechSynthesisInstance = null;
        speechBtn.textContent = translations[currentLanguage].listenArticle;
        return;
      }
      let voices = window.speechSynthesis.getVoices();
      let selectedVoice = voices.find(voice => voice.lang.startsWith(currentLanguage === 'ar' ? 'ar' : 'en'));
      speechSynthesisInstance = new SpeechSynthesisUtterance(text);
      if (selectedVoice) {
        speechSynthesisInstance.voice = selectedVoice;
      }
      speechSynthesisInstance.lang = currentLanguage === 'ar' ? 'ar-EG' : 'en-US';
      window.speechSynthesis.speak(speechSynthesisInstance);
      speechBtn.textContent = translations[currentLanguage].stopListening;
    }
    // -------------------- YouTube Video --------------------
    function fetchYouTubeVideo(query) {
      if(query.trim().toLowerCase() === "egypt") {
        query = "Egypt history";
      }
      const youtubeApiUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&key=${YOUTUBE_API_KEY}&type=video&maxResults=1`;
      fetch(youtubeApiUrl)
        .then(response => response.json())
        .then(data => {
          if (data.items && data.items.length > 0) {
            const video = data.items[0];
            displayYouTubeVideo(video);
          } else {
            document.getElementById("youtube-video").innerHTML = `<p>${translations[currentLanguage].noResults}</p>`;
          }
        })
        .catch(error => {
          console.error("Error fetching YouTube video:", error);
        });
    }
    function displayYouTubeVideo(video) {
      document.getElementById("youtube-video").innerHTML = `
        <div class="video-player">
          <iframe width="100%" height="315" src="https://www.youtube.com/embed/${video.id.videoId}" 
          frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
          allowfullscreen></iframe>
          <p>${video.snippet.title}</p>
        </div>
      `;
    }
    // -------------------- Add Enter Key Support for Search --------------------
    document.getElementById("search-bar").addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        e.preventDefault();
        fetchContent();
      }
    });
    // Preload voices (some browsers require this)
    window.speechSynthesis.onvoiceschanged = () => {
      window.speechSynthesis.getVoices();
    };
    // -------------------- On DOM Loaded --------------------
    document.addEventListener("DOMContentLoaded", () => {
      showSection("app");
      window.speechSynthesis.getVoices();
      fetchContent("Ø§Ù„Ø­Ø¶Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙŠØ©");
    });
  </script>
</body>
</html>
